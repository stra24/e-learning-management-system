<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.everrefine.elms.infrastructure.mapper.LessonMapper">

<!--  <delete id="deleteLessonById">-->
  <!--    DELETE FROM lessons-->
  <!--    WHERE-->
  <!--    id = #{id}-->
  <!--  </delete>-->

  <!--  <insert-->
  <!--    id="createLesson"-->
  <!--    parameterType="com.everrefine.elms.domain.model.lesson.Lesson"-->
  <!--  >-->
  <!--    INSERT INTO lessons (-->
  <!--    id,-->
  <!--    lesson_group_id,-->
  <!--    course_id,-->
  <!--    title,-->
  <!--    description,-->
  <!--    video_url,-->
  <!--    created_at,-->
  <!--    updated_at-->
  <!--    ) VALUES (-->
  <!--    #{id},-->
  <!--    #{lessonGroupId},-->
  <!--    #{courseId},-->
  <!--    #{title},-->
  <!--    #{description},-->
  <!--    #{videoUrl},-->
  <!--    #{createdAt},-->
  <!--    #{updatedAt}-->
  <!--    )-->
  <!--  </insert>-->

  <!--  <select id="findLessonById" resultType="com.everrefine.elms.domain.model.lesson.Lesson">-->
  <!--    SELECT-->
  <!--    *-->
  <!--    FROM-->
  <!--    lessons-->
  <!--    WHERE id = #{id}-->
  <!--  </select>-->

  <select
    id="existsLessonByCourseId"
    parameterType="java.util.UUID"
    resultType="boolean"
  >
    SELECT EXISTS (
      SELECT 1
      FROM lessons
      WHERE course_id = #{courseId}
    )
  </select>

  <select
      id="findFirstLessonIdByCourseId"
      parameterType="java.util.UUID"
      resultType="java.util.UUID"
  >
    SELECT
      l.id
    FROM
      lessons        AS l
    JOIN
      lesson_groups  AS lg
    ON
      l.lesson_group_id = lg.id
    WHERE
      lg.course_id = #{courseId}
    ORDER BY
      lg.lesson_group_order ASC,
      l.lesson_order        ASC
    LIMIT
      1
  </select>
</mapper>